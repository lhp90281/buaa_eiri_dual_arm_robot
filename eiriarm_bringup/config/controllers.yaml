controller_manager:
  ros__parameters:
    update_rate: 300  # 控制频率 Hz

    # 定义要加载的控制器列表
    joint_state_broadcaster:
      type: joint_state_broadcaster/JointStateBroadcaster

    joint_trajectory_controller:
      type: joint_trajectory_controller/JointTrajectoryController

    forward_effort_controller:
      type: forward_command_controller/ForwardCommandController

# 配置具体控制器的参数
forward_effort_controller:
  ros__parameters:
    joints:
      # 左臂
      - left_joint_0
      - left_joint_1
      - left_joint_2
      - left_joint_3
      - left_joint_4
      - left_joint_5
      - left_joint_6
      # 右臂
      - right_joint_0
      - right_joint_1
      - right_joint_2
      - right_joint_3
      - right_joint_4
      - right_joint_5
      - right_joint_6
      # 夹爪
      - left_gripper_right_finger_joint
      - right_gripper_right_finger_joint
    interface_name: effort

joint_trajectory_controller:
  ros__parameters:
    joints:
      # 左臂
      - left_joint_0
      - left_joint_1
      - left_joint_2
      - left_joint_3
      - left_joint_4
      - left_joint_5
      - left_joint_6
      # 右臂
      - right_joint_0
      - right_joint_1
      - right_joint_2
      - right_joint_3
      - right_joint_4
      - right_joint_5
      - right_joint_6
      # 夹爪 (可选，或者用单独的控制器)
      - left_gripper_right_finger_joint
      - right_gripper_right_finger_joint

    command_interfaces:
      - effort # 你的硬件接口是 effort，这里必须匹配
      
    state_interfaces:
      - position
      - velocity
    
    # === 关键配置 ===
    allow_partial_joints_goal: true  # 允许只发送部分关节的指令
    open_loop_control: false          # 如果只是仿真且没有严格的力矩反馈，开环通常更稳
    allow_integration_in_goal_trajectories: true
    
    # 稍微放宽一点约束，避免一开始就报错停止
    constraints:
      goal_time: 0.0
      stopped_velocity_tolerance: 0.01
      left_joint_0: {trajectory: 0.1, goal: 0.1}
      right_joint_0: {trajectory: 0.1, goal: 0.1}

    gains:
      # ================== 左臂 Left Arm ==================
      left_joint_0: {p: 2000.0, i: 0.0, d: 50.0, ff_velocity_scale: 0.0}
      left_joint_1: {p: 2000.0, i: 0.0, d: 50.0, ff_velocity_scale: 0.0}
      left_joint_2: {p: 1000.0, i: 0.0, d: 30.0, ff_velocity_scale: 0.0}
      left_joint_3: {p: 800.0,  i: 0.0, d: 20.0, ff_velocity_scale: 0.0}
      left_joint_4: {p: 200.0,  i: 0.0, d: 5.0,  ff_velocity_scale: 0.0}
      left_joint_5: {p: 100.0,  i: 0.0, d: 2.0,  ff_velocity_scale: 0.0}
      left_joint_6: {p: 50.0,   i: 0.0, d: 1.0,  ff_velocity_scale: 0.0}

      # ================== 右臂 Right Arm ==================
      right_joint_0: {p: 2000.0, i: 0.0, d: 50.0, ff_velocity_scale: 0.0}
      right_joint_1: {p: 2000.0, i: 0.0, d: 50.0, ff_velocity_scale: 0.0}
      right_joint_2: {p: 1000.0, i: 0.0, d: 30.0, ff_velocity_scale: 0.0}
      right_joint_3: {p: 800.0,  i: 0.0, d: 20.0, ff_velocity_scale: 0.0}
      right_joint_4: {p: 200.0,  i: 0.0, d: 5.0,  ff_velocity_scale: 0.0}
      right_joint_5: {p: 100.0,  i: 0.0, d: 2.0,  ff_velocity_scale: 0.0}
      right_joint_6: {p: 50.0,   i: 0.0, d: 1.0,  ff_velocity_scale: 0.0}

      # ================== 夹爪 Grippers ==================
      left_gripper_right_finger_joint:  {p: 200.0, i: 0.0, d: 5.0, ff_velocity_scale: 0.0}
      right_gripper_right_finger_joint: {p: 200.0, i: 0.0, d: 5.0, ff_velocity_scale: 0.0}
    # 如果是仿真，稍微调低一点 PID 增益或者开环控制
    # 因为我们是把 effort 直接透传给 MuJoCo，MuJoCo 内部会处理动力学
    # 这里通常不需要写 gains，除非你用 Position 接口但硬件是 Effort